<%- include("../../views/partials/admin/header") %>

<div class="container mt-4">
  <h3>Orders</h3>

  <!-- Search form -->
  <form class="row g-3 mb-4" method="GET" action="/admin/orders">
    <div class="col-auto">
      <input
        type="text"
        name="search"
        class="form-control"
        placeholder="Search by Order ID or Customer"
        value="<%= typeof search !== 'undefined' ? search : '' %>"
      />
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Search</button>
      <a href="/admin/orders" class="btn btn-secondary ms-2">Clear</a>
    </div>
  </form>

  <!-- Orders Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-hover text-center align-middle">
      <thead class="table-light">
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Total (Â£)</th>
          <th>Status</th>
          <th>Order Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (orders.length === 0) { %>
          <tr>
            <td colspan="6">No orders found.</td>
          </tr>
        <% } else { %>
          <% orders.forEach(order => { %>
            <tr>
              <td><%= order._id %></td>
              <td><%= order.customerName || 'N/A' %></td>
              <td><%= order.totalAmount.toFixed(2) %></td>
              <td>
                <span class="badge
                  <% if(order.status === 'Pending') { %> bg-warning
                  <% } else if(order.status === 'Completed') { %> bg-success
                  <% } else if(order.status === 'Cancelled') { %> bg-danger
                  <% } else { %> bg-secondary <% } %>">
                  <%= order.status %>
                </span>
              </td>
              <td><%= new Date(order.createdAt).toLocaleDateString() %></td>
              <td>
                <a href="/admin/orders/<%= order._id %>" class="btn btn-sm btn-info me-1">View</a>
                <!-- Example: Status update button -->
                <!-- <button class="btn btn-sm btn-primary">Update Status</button> -->
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if (totalPages && totalPages > 1) { %>
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= currentPage == i ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %><%= search ? '&search=' + encodeURIComponent(search) : '' %>"><%= i %></a>
          </li>
        <% } %>
      </ul>
    </nav>
  <% } %>
</div>

<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
