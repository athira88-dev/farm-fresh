<%- include("../../views/partials/admin/header") %>

<section class="content-main">
      <h2 class="content-title card-title">Dashboard</h2>
  <div class="content-header">
  
    <h4 class="content-title card-title">Sales Report</h4>
  </div>

  <form id="salesFilterForm" method="GET" action="/admin">
    <div class="row mb-3">
      <div class="col-md-3">
        <label>From:</label>
        <input type="date" name="startDate" class="form-control" value="<%= startDate %>">
      </div>
      <div class="col-md-3">
        <label>To:</label>
        <input type="date" name="endDate" class="form-control" value="<%= endDate %>">
      </div>
      <div class="col-md-3">
        <label>Group By:</label>
        <select name="groupBy" class="form-control">
          <option value="">-- Select --</option>
          <option value="day" <%= groupBy === 'day' ? 'selected' : '' %>>Daily</option>
          <option value="week" <%= groupBy === 'week' ? 'selected' : '' %>>Weekly</option>
          <option value="month" <%= groupBy === 'month' ? 'selected' : '' %>>Monthly</option>
          <option value="year" <%= groupBy === 'year' ? 'selected' : '' %>>Yearly</option>
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary">Generate</button>
      </div>
    </div>
  </form>

  <% if (reportData && reportData.length > 0) { %>
    <div class="card mt-4">
      <div class="card-body">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Period</th>
              <th>Total Orders</th>
              <th>Total Sales</th>
              <th>Total Discount</th>
              <th>Final Amount</th>
            </tr>
          </thead>
          <tbody>
            <% reportData.forEach(row => { %>
              <tr>
                <td>
                  <% if (row._id.day) { %>
                    <%= row._id.day %>-<%= row._id.month %>-<%= row._id.year %>
                  <% } else if (row._id.week) { %>
                    Week <%= row._id.week %>, <%= row._id.year %>
                  <% } else if (row._id.month) { %>
                    <%= row._id.month %>-<%= row._id.year %>
                  <% } else if (row._id.year) { %>
                    <%= row._id.year %>
                  <% } else { %>
                    Total
                  <% } %>
                </td>
                <td><%= row.totalOrders %></td>
                <td>£ <%= row.totalPrice.toFixed(2) %></td>
                <td>£ <%= row.totalDiscount.toFixed(2) %></td>
                <td>£ <%= row.totalFinalAmount.toFixed(2) %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
        <div class="text-end mt-3">
          <a href="/admin/sales-report/download-pdf?<%= queryString %>" class="btn btn-danger me-2">Download PDF</a>
          <a href="/admin/sales-report/download-excel?<%= queryString %>" class="btn btn-success">Download Excel</a>
        </div>
      </div>
    </div>
  <% } else { %>
    <p class="text-muted">No data to show. Use filters above to generate report.</p>
  <% } %>
</section>

<%- include("../../views/partials/admin/footer") %>
